# photostore
AWSで写真管理

## 今の運用
- 個人のHDDにMacの写真ライブラリを作って写真管理をしている
- コストの問題でiCloud課金はしていない
- iCloud無料枠の5GB到達前後で、半分くらいをライブラリに移動している
- この作業は3ヶ月に1回くらい。およそ1GB/月くらいとする。
- 写真移動のタイミングで目ぼしい写真を選んでiCloud共有ライブラリにも登録することで、HDDへの移動後も写真を確認できる。

## 悩み
- 移動作業にPCを使うので面倒
- 移動作業をサボるとiCloudが容量いっぱいで写真バックアップされなくなる
- HDDにも寿命がある。現時点で8年くらいは断続的に使用している。
- Macの写真アプリは気が利きすぎて挙動がわからないことがある。

## 希望
- 低価格で安全に写真をバックアップしたい
- 写真を簡単に見返したい
- 場所と期間の2軸で写真を探したい。
- 写真移動にできればPCを使いたくない

## ソリューション

### データ管理
- S3 Intelligent-Tieringで一旦2階層で持たせる
- 3層目は独自実装で適当なGlacierに移動させて適宜復元させる仕組みを持つ
- S3保存を起点にサムネイル作成とメタデータ保存など行う
- サムネイルはアーカイブさせない。オリジナルデータのみアーカイブさせる。
- 動画のサムネイルはGIF化。ffmpegが使えるかも。
- 場所情報はGeohashを活用してクエリできるようにする
- メタデータなどはDynamoDBを使用
- S3リクエスト数軽減のためCloudFrontを使用
- 画像のデータのキャッシュ時間はかなり長めにする

### 写真ブラウザ
- Web実装、SPAアプリ。
- モバイル対応
- 画像の遅延読み込み
- 無限スクロールに近いもの
- 年度ごとにアーカイブからまとめて復元させる機能（Glacier一括取り出しの機能か？）
- お気に入り機能
- アルバム機能
- 共有機能（期限付きURLで公開するみたいな？）
- S3+lambda+DynamoDBにより完全サーバーレスで実装する

## セキュリティ
- CloudFrontは署名つきCookie機能を使って制限
- ログイン画面は必要
